<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Calculator & Minesweeper</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
      @keyframes confetti-fall {
        0% {
          transform: translateY(0) rotate(0deg);
          opacity: 1;
        }
        100% {
          transform: translateY(100vh) rotate(720deg);
          opacity: 0;
        }
      }
      .animate-confetti {
        animation: confetti-fall linear forwards;
      }

      /* Glass morphism effects */
      .glass {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .glass-dark {
        background: rgba(30, 30, 30, 0.7);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      /* Toggle switch styles */
      .toggle-track {
        background: rgba(120, 120, 128, 0.32);
        transition: background-color 0.3s ease;
      }

      .toggle-track.active {
        background: rgba(52, 199, 89, 0.8);
      }

      .toggle-thumb {
        background: linear-gradient(180deg, #ffffff 0%, #f0f0f0 100%);
        box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15), 0 1px 3px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      /* Minesweeper cell styles */
      .cell {
        background: rgba(60, 60, 67, 0.6);
        backdrop-filter: blur(8px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        transition: all 0.15s ease;
      }

      .cell:hover:not(.revealed):not(.flagged) {
        background: rgba(80, 80, 87, 0.7);
        transform: scale(1.02);
      }

      .cell.revealed {
        background: rgba(40, 40, 45, 0.8);
        border-color: rgba(255, 255, 255, 0.05);
      }

      .cell.mine {
        background: rgba(255, 59, 48, 0.6);
      }

      .cell.flagged {
        background: rgba(255, 149, 0, 0.4);
      }

      /* Number colors for minesweeper */
      .num-1 { color: #5AC8FA; }
      .num-2 { color: #34C759; }
      .num-3 { color: #FF3B30; }
      .num-4 { color: #AF52DE; }
      .num-5 { color: #FF9500; }
      .num-6 { color: #00C7BE; }
      .num-7 { color: #FF2D55; }
      .num-8 { color: #8E8E93; }

      /* Fire explosion effect */
      @keyframes fire-pulse {
        0% { opacity: 0; transform: scale(0.8); }
        50% { opacity: 1; transform: scale(1.1); }
        100% { opacity: 1; transform: scale(1); }
      }

      @keyframes flame-flicker {
        0%, 100% { opacity: 0.8; transform: translateY(0) scale(1); }
        25% { opacity: 1; transform: translateY(-5px) scale(1.05); }
        50% { opacity: 0.9; transform: translateY(-2px) scale(0.98); }
        75% { opacity: 1; transform: translateY(-7px) scale(1.08); }
      }

      @keyframes ember-rise {
        0% {
          transform: translateY(0) translateX(0) scale(1);
          opacity: 1;
        }
        50% {
          transform: translateY(-50vh) translateX(calc(var(--drift) * 0.5)) scale(0.7);
          opacity: 0.8;
        }
        100% {
          transform: translateY(-100vh) translateX(var(--drift)) scale(0);
          opacity: 0;
        }
      }

      .fire-explosion {
        position: fixed;
        inset: 0;
        z-index: 1;
        pointer-events: none;
        background: radial-gradient(circle at center,
          rgba(255, 100, 0, 0.4) 0%,
          rgba(255, 50, 0, 0.3) 20%,
          rgba(200, 0, 0, 0.2) 40%,
          rgba(0, 0, 0, 0.95) 70%,
          rgba(0, 0, 0, 1) 100%);
        animation: fire-pulse 1s ease-out forwards;
      }

      .flame {
        position: absolute;
        background: radial-gradient(ellipse at center,
          rgba(255, 200, 0, 0.8) 0%,
          rgba(255, 100, 0, 0.6) 30%,
          rgba(255, 0, 0, 0.4) 60%,
          transparent 100%);
        border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
        animation: flame-flicker 0.3s ease-in-out infinite;
      }

      .ember {
        position: absolute;
        background: radial-gradient(circle,
          rgba(255, 200, 100, 1) 0%,
          rgba(255, 100, 0, 0.8) 50%,
          transparent 100%);
        border-radius: 50%;
        animation: ember-rise linear infinite;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useEffect, useCallback } = React;

      // ==================== TOGGLE SWITCH ====================
      const ToggleSwitch = ({ isOn, onToggle }) => {
        return (
          <div className="fixed top-6 left-1/2 transform -translate-x-1/2 z-50">
            <div
              className={`toggle-track w-16 h-9 rounded-full p-1 cursor-pointer flex items-center ${isOn ? 'active' : ''}`}
              onClick={onToggle}
            >
              <div
                className={`toggle-thumb w-7 h-7 rounded-full flex items-center justify-center ${isOn ? 'translate-x-7' : 'translate-x-0'}`}
              >
                <span className="text-gray-600 font-semibold text-sm select-none">
                  {isOn ? 'I' : 'O'}
                </span>
              </div>
            </div>
          </div>
        );
      };

      // ==================== CONFETTI ====================
      const Confetti = ({ particles }) => {
        return (
          <div className="fixed inset-0 pointer-events-none overflow-hidden z-40">
            {particles.map((particle) => (
              <div
                key={particle.id}
                className="absolute animate-confetti"
                style={{
                  left: particle.x + '%',
                  top: '-20px',
                  backgroundColor: particle.color,
                  width: particle.size + 'px',
                  height: particle.size + 'px',
                  borderRadius: particle.shape === 'circle' ? '50%' : '0',
                  transform: `rotate(${particle.rotation}deg)`,
                  animationDuration: particle.duration + 's',
                  animationDelay: particle.delay + 's',
                }}
              />
            ))}
          </div>
        );
      };

      // ==================== FIRE EXPLOSION ====================
      const FireExplosion = () => {
        const [flames, setFlames] = useState([]);
        const [embers, setEmbers] = useState([]);

        useEffect(() => {
          // Generate flames
          const flameArray = [];
          for (let i = 0; i < 30; i++) {
            flameArray.push({
              id: i,
              left: Math.random() * 100,
              top: Math.random() * 100,
              width: Math.random() * 150 + 100,
              height: Math.random() * 200 + 150,
              delay: Math.random() * 0.5,
            });
          }
          setFlames(flameArray);

          // Generate embers - create multiple sets for continuous effect
          const emberArray = [];
          for (let i = 0; i < 100; i++) {
            emberArray.push({
              id: i,
              left: Math.random() * 100,
              bottom: Math.random() * 30,
              size: Math.random() * 8 + 3,
              duration: Math.random() * 4 + 3,
              delay: Math.random() * 5,
              drift: (Math.random() - 0.5) * 100,
            });
          }
          setEmbers(emberArray);
        }, []);

        return (
          <div className="fire-explosion">
            {flames.map((flame) => (
              <div
                key={`flame-${flame.id}`}
                className="flame"
                style={{
                  left: flame.left + '%',
                  top: flame.top + '%',
                  width: flame.width + 'px',
                  height: flame.height + 'px',
                  animationDelay: flame.delay + 's',
                }}
              />
            ))}
            {embers.map((ember) => (
              <div
                key={`ember-${ember.id}`}
                className="ember"
                style={{
                  left: ember.left + '%',
                  bottom: ember.bottom + '%',
                  width: ember.size + 'px',
                  height: ember.size + 'px',
                  animationDuration: ember.duration + 's',
                  animationDelay: ember.delay + 's',
                  '--drift': ember.drift + 'px',
                }}
              />
            ))}
          </div>
        );
      };

      // ==================== CALCULATOR ====================
      const Calculator = ({ onConfetti }) => {
        const [display, setDisplay] = useState('0');
        const [previousValue, setPreviousValue] = useState(null);
        const [operator, setOperator] = useState(null);
        const [waitingForOperand, setWaitingForOperand] = useState(false);

        const inputDigit = (digit) => {
          if (waitingForOperand) {
            setDisplay(digit);
            setWaitingForOperand(false);
          } else {
            setDisplay(display === '0' ? digit : display + digit);
          }
        };

        const inputDecimal = () => {
          if (waitingForOperand) {
            setDisplay('0.');
            setWaitingForOperand(false);
            return;
          }
          if (!display.includes('.')) {
            setDisplay(display + '.');
          }
        };

        const clear = () => {
          setDisplay('0');
          setPreviousValue(null);
          setOperator(null);
          setWaitingForOperand(false);
        };

        const performOperation = (nextOperator) => {
          const inputValue = parseFloat(display);

          if (previousValue === null) {
            setPreviousValue(inputValue);
          } else if (operator) {
            const currentValue = previousValue || 0;
            let result;

            switch (operator) {
              case '+': result = currentValue + inputValue; break;
              case '-': result = currentValue - inputValue; break;
              case 'Ã—': result = currentValue * inputValue; break;
              case 'Ã·': result = inputValue !== 0 ? currentValue / inputValue : 'Error'; break;
              default: result = inputValue;
            }

            setDisplay(String(result));
            setPreviousValue(result);
          }

          setWaitingForOperand(true);
          setOperator(nextOperator);
        };

        const calculate = () => {
          if (!operator || previousValue === null) return;

          const inputValue = parseFloat(display);
          let result;

          switch (operator) {
            case '+': result = previousValue + inputValue; break;
            case '-': result = previousValue - inputValue; break;
            case 'Ã—': result = previousValue * inputValue; break;
            case 'Ã·': result = inputValue !== 0 ? previousValue / inputValue : 'Error'; break;
            default: result = inputValue;
          }

          setDisplay(String(result));
          setPreviousValue(null);
          setOperator(null);
          setWaitingForOperand(true);
          onConfetti();
        };

        const toggleSign = () => setDisplay(String(parseFloat(display) * -1));
        const inputPercent = () => setDisplay(String(parseFloat(display) / 100));

        const Button = ({ onClick, className, children }) => (
          <button
            onClick={onClick}
            className={`flex items-center justify-center text-2xl font-medium rounded-full h-16 w-16 transition-all duration-150 active:scale-95 ${className}`}
          >
            {children}
          </button>
        );

        return (
          <div className="bg-black rounded-3xl p-4 w-80">
            <div className="h-24 flex items-end justify-end px-2 mb-2">
              <span className="text-white text-6xl font-light truncate">
                {display.length > 9 ? parseFloat(display).toExponential(4) : display}
              </span>
            </div>

            <div className="grid grid-cols-4 gap-3">
              <Button onClick={clear} className="bg-gray-400 text-black hover:bg-gray-300">
                {previousValue || operator ? 'C' : 'AC'}
              </Button>
              <Button onClick={toggleSign} className="bg-gray-400 text-black hover:bg-gray-300">Â±</Button>
              <Button onClick={inputPercent} className="bg-gray-400 text-black hover:bg-gray-300">%</Button>
              <Button onClick={() => performOperation('Ã·')} className={`${operator === 'Ã·' ? 'bg-white text-orange-500' : 'bg-orange-500 text-white hover:bg-orange-400'}`}>Ã·</Button>

              <Button onClick={() => inputDigit('7')} className="bg-gray-700 text-white hover:bg-gray-600">7</Button>
              <Button onClick={() => inputDigit('8')} className="bg-gray-700 text-white hover:bg-gray-600">8</Button>
              <Button onClick={() => inputDigit('9')} className="bg-gray-700 text-white hover:bg-gray-600">9</Button>
              <Button onClick={() => performOperation('Ã—')} className={`${operator === 'Ã—' ? 'bg-white text-orange-500' : 'bg-orange-500 text-white hover:bg-orange-400'}`}>Ã—</Button>

              <Button onClick={() => inputDigit('4')} className="bg-gray-700 text-white hover:bg-gray-600">4</Button>
              <Button onClick={() => inputDigit('5')} className="bg-gray-700 text-white hover:bg-gray-600">5</Button>
              <Button onClick={() => inputDigit('6')} className="bg-gray-700 text-white hover:bg-gray-600">6</Button>
              <Button onClick={() => performOperation('-')} className={`${operator === '-' ? 'bg-white text-orange-500' : 'bg-orange-500 text-white hover:bg-orange-400'}`}>âˆ’</Button>

              <Button onClick={() => inputDigit('1')} className="bg-gray-700 text-white hover:bg-gray-600">1</Button>
              <Button onClick={() => inputDigit('2')} className="bg-gray-700 text-white hover:bg-gray-600">2</Button>
              <Button onClick={() => inputDigit('3')} className="bg-gray-700 text-white hover:bg-gray-600">3</Button>
              <Button onClick={() => performOperation('+')} className={`${operator === '+' ? 'bg-white text-orange-500' : 'bg-orange-500 text-white hover:bg-orange-400'}`}>+</Button>

              <button onClick={() => inputDigit('0')} className="col-span-2 flex items-center justify-start pl-6 text-2xl font-medium rounded-full h-16 bg-gray-700 text-white hover:bg-gray-600 transition-all duration-150 active:scale-95">0</button>
              <Button onClick={inputDecimal} className="bg-gray-700 text-white hover:bg-gray-600">.</Button>
              <Button onClick={calculate} className="bg-orange-500 text-white hover:bg-orange-400">=</Button>
            </div>
          </div>
        );
      };

      // ==================== MINESWEEPER ====================
      const Minesweeper = ({ onExplosion, onReset }) => {
        const GRID_SIZE = 9;
        const MINE_COUNT = 10;

        const [grid, setGrid] = useState([]);
        const [gameState, setGameState] = useState('playing'); // 'playing', 'won', 'lost'
        const [flagCount, setFlagCount] = useState(0);
        const [time, setTime] = useState(0);
        const [isFirstClick, setIsFirstClick] = useState(true);

        const createEmptyGrid = () => {
          return Array(GRID_SIZE).fill(null).map(() =>
            Array(GRID_SIZE).fill(null).map(() => ({
              isMine: false,
              isRevealed: false,
              isFlagged: false,
              neighborMines: 0,
            }))
          );
        };

        const placeMines = (grid, excludeRow, excludeCol) => {
          const newGrid = JSON.parse(JSON.stringify(grid));
          let minesPlaced = 0;

          while (minesPlaced < MINE_COUNT) {
            const row = Math.floor(Math.random() * GRID_SIZE);
            const col = Math.floor(Math.random() * GRID_SIZE);

            // Don't place mine on first click or adjacent cells
            const isExcluded = Math.abs(row - excludeRow) <= 1 && Math.abs(col - excludeCol) <= 1;

            if (!newGrid[row][col].isMine && !isExcluded) {
              newGrid[row][col].isMine = true;
              minesPlaced++;
            }
          }

          // Calculate neighbor mines
          for (let row = 0; row < GRID_SIZE; row++) {
            for (let col = 0; col < GRID_SIZE; col++) {
              if (!newGrid[row][col].isMine) {
                let count = 0;
                for (let dr = -1; dr <= 1; dr++) {
                  for (let dc = -1; dc <= 1; dc++) {
                    const nr = row + dr;
                    const nc = col + dc;
                    if (nr >= 0 && nr < GRID_SIZE && nc >= 0 && nc < GRID_SIZE && newGrid[nr][nc].isMine) {
                      count++;
                    }
                  }
                }
                newGrid[row][col].neighborMines = count;
              }
            }
          }

          return newGrid;
        };

        const initGame = useCallback(() => {
          setGrid(createEmptyGrid());
          setGameState('playing');
          setFlagCount(0);
          setTime(0);
          setIsFirstClick(true);
          onReset(); // Reset explosion when game resets
        }, [onReset]);

        useEffect(() => {
          initGame();
        }, [initGame]);

        useEffect(() => {
          let interval;
          if (gameState === 'playing' && !isFirstClick) {
            interval = setInterval(() => setTime(t => t + 1), 1000);
          }
          return () => clearInterval(interval);
        }, [gameState, isFirstClick]);

        const revealCell = (grid, row, col) => {
          const newGrid = JSON.parse(JSON.stringify(grid));
          const cell = newGrid[row][col];

          if (cell.isRevealed || cell.isFlagged) return newGrid;

          cell.isRevealed = true;

          if (cell.neighborMines === 0 && !cell.isMine) {
            for (let dr = -1; dr <= 1; dr++) {
              for (let dc = -1; dc <= 1; dc++) {
                const nr = row + dr;
                const nc = col + dc;
                if (nr >= 0 && nr < GRID_SIZE && nc >= 0 && nc < GRID_SIZE) {
                  if (!newGrid[nr][nc].isRevealed) {
                    const result = revealCell(newGrid, nr, nc);
                    for (let r = 0; r < GRID_SIZE; r++) {
                      for (let c = 0; c < GRID_SIZE; c++) {
                        newGrid[r][c] = result[r][c];
                      }
                    }
                  }
                }
              }
            }
          }

          return newGrid;
        };

        const checkWin = (grid) => {
          for (let row = 0; row < GRID_SIZE; row++) {
            for (let col = 0; col < GRID_SIZE; col++) {
              const cell = grid[row][col];
              if (!cell.isMine && !cell.isRevealed) return false;
            }
          }
          return true;
        };

        const handleClick = (row, col) => {
          if (gameState !== 'playing') return;

          let currentGrid = grid;

          if (isFirstClick) {
            currentGrid = placeMines(grid, row, col);
            setIsFirstClick(false);
          }

          const cell = currentGrid[row][col];
          if (cell.isRevealed || cell.isFlagged) return;

          if (cell.isMine) {
            // Reveal all mines
            const newGrid = JSON.parse(JSON.stringify(currentGrid));
            for (let r = 0; r < GRID_SIZE; r++) {
              for (let c = 0; c < GRID_SIZE; c++) {
                if (newGrid[r][c].isMine) newGrid[r][c].isRevealed = true;
              }
            }
            setGrid(newGrid);
            setGameState('lost');
            onExplosion(); // Trigger fire explosion
            return;
          }

          const newGrid = revealCell(currentGrid, row, col);
          setGrid(newGrid);

          if (checkWin(newGrid)) {
            setGameState('won');
          }
        };

        const handleRightClick = (e, row, col) => {
          e.preventDefault();
          if (gameState !== 'playing') return;

          const cell = grid[row][col];
          if (cell.isRevealed) return;

          const newGrid = JSON.parse(JSON.stringify(grid));
          newGrid[row][col].isFlagged = !newGrid[row][col].isFlagged;
          setGrid(newGrid);
          setFlagCount(prev => newGrid[row][col].isFlagged ? prev + 1 : prev - 1);
        };

        const formatTime = (seconds) => {
          const mins = Math.floor(seconds / 60);
          const secs = seconds % 60;
          return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        };

        const getCellContent = (cell) => {
          if (cell.isFlagged) return 'ðŸš©';
          if (!cell.isRevealed) return '';
          if (cell.isMine) return 'ðŸ’£';
          if (cell.neighborMines === 0) return '';
          return cell.neighborMines;
        };

        return (
          <div className="glass-dark rounded-3xl p-6 w-auto">
            {/* Header */}
            <div className="flex justify-between items-center mb-4 px-2">
              <div className="glass rounded-xl px-4 py-2 flex items-center gap-2">
                <span className="text-xl">ðŸš©</span>
                <span className="text-white font-mono text-lg">{MINE_COUNT - flagCount}</span>
              </div>

              <button
                onClick={initGame}
                className="glass rounded-xl px-4 py-2 text-2xl hover:bg-white/20 transition-all active:scale-95"
              >
                {gameState === 'won' ? 'ðŸ˜Ž' : gameState === 'lost' ? 'ðŸ˜µ' : 'ðŸ™‚'}
              </button>

              <div className="glass rounded-xl px-4 py-2">
                <span className="text-white font-mono text-lg">{formatTime(time)}</span>
              </div>
            </div>

            {/* Game status */}
            {gameState !== 'playing' && (
              <div className={`text-center mb-4 py-2 rounded-xl ${gameState === 'won' ? 'bg-green-500/30' : 'bg-red-500/30'}`}>
                <span className="text-white font-semibold text-lg">
                  {gameState === 'won' ? 'ðŸŽ‰ You Won!' : 'ðŸ’¥ Game Over'}
                </span>
              </div>
            )}

            {/* Grid */}
            <div
              className="grid gap-1"
              style={{ gridTemplateColumns: `repeat(${GRID_SIZE}, 1fr)` }}
            >
              {grid.map((row, rowIdx) =>
                row.map((cell, colIdx) => (
                  <button
                    key={`${rowIdx}-${colIdx}`}
                    onClick={() => handleClick(rowIdx, colIdx)}
                    onContextMenu={(e) => handleRightClick(e, rowIdx, colIdx)}
                    className={`
                      cell w-9 h-9 rounded-lg flex items-center justify-center text-sm font-bold
                      ${cell.isRevealed ? 'revealed' : ''}
                      ${cell.isRevealed && cell.isMine ? 'mine' : ''}
                      ${cell.isFlagged ? 'flagged' : ''}
                      ${cell.neighborMines > 0 ? `num-${cell.neighborMines}` : ''}
                    `}
                  >
                    {getCellContent(cell)}
                  </button>
                ))
              )}
            </div>

            {/* Instructions */}
            <div className="mt-4 text-center text-gray-400 text-xs">
              Left click to reveal â€¢ Right click to flag
            </div>
          </div>
        );
      };

      // ==================== MAIN APP ====================
      function App() {
        const [isCalculator, setIsCalculator] = useState(true);
        const [isTransitioning, setIsTransitioning] = useState(false);
        const [showCalculator, setShowCalculator] = useState(true);
        const [confettiParticles, setConfettiParticles] = useState([]);
        const [showExplosion, setShowExplosion] = useState(false);

        const handleToggle = () => {
          if (isTransitioning) return;

          setIsTransitioning(true);
          setShowExplosion(false); // Reset explosion on toggle

          // Start fade out
          setTimeout(() => {
            setShowCalculator(!isCalculator);
            setIsCalculator(!isCalculator);
          }, 1000);

          // End transition
          setTimeout(() => {
            setIsTransitioning(false);
          }, 2000);
        };

        const triggerConfetti = () => {
          const colors = ['#ff6b6b', '#4ecdc4', '#ffe66d', '#95e1d3', '#f38181', '#aa96da', '#fcbad3', '#a8d8ea'];
          const particles = [];

          for (let i = 0; i < 50; i++) {
            particles.push({
              id: i,
              x: Math.random() * 100,
              color: colors[Math.floor(Math.random() * colors.length)],
              size: Math.random() * 10 + 5,
              shape: Math.random() > 0.5 ? 'circle' : 'square',
              rotation: Math.random() * 360,
              duration: Math.random() * 2 + 2,
              delay: Math.random() * 0.5,
            });
          }

          setConfettiParticles(particles);
          setTimeout(() => setConfettiParticles([]), 3000);
        };

        const triggerExplosion = () => {
          setShowExplosion(true);
        };

        const resetExplosion = () => {
          setShowExplosion(false);
        };

        // Calculate opacity for smooth transition
        const getOpacity = () => {
          if (!isTransitioning) return 1;
          return 0;
        };

        return (
          <>
            {showExplosion && <FireExplosion />}
            <Confetti particles={confettiParticles} />
            <ToggleSwitch isOn={isCalculator} onToggle={handleToggle} />

            <div className="min-h-screen bg-black flex items-center justify-center p-4 pt-20">
              <div
                className="transition-opacity duration-[1000ms] ease-in-out"
                style={{ opacity: isTransitioning ? 0 : 1 }}
              >
                {showCalculator ? (
                  <Calculator onConfetti={triggerConfetti} />
                ) : (
                  <Minesweeper onExplosion={triggerExplosion} onReset={resetExplosion} />
                )}
              </div>
            </div>
          </>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html>
