<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Confetti Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
      @keyframes confetti-fall {
        0% {
          transform: translateY(0) rotate(0deg);
          opacity: 1;
        }
        100% {
          transform: translateY(100vh) rotate(720deg);
          opacity: 0;
        }
      }
      .animate-confetti {
        animation: confetti-fall linear forwards;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useEffect } = React;

      // Confetti particle component
      const Confetti = ({ particles }) => {
        return (
          <div className="fixed inset-0 pointer-events-none overflow-hidden z-50">
            {particles.map((particle) => (
              <div
                key={particle.id}
                className="absolute animate-confetti"
                style={{
                  left: particle.x + '%',
                  top: '-20px',
                  backgroundColor: particle.color,
                  width: particle.size + 'px',
                  height: particle.size + 'px',
                  borderRadius: particle.shape === 'circle' ? '50%' : '0',
                  transform: `rotate(${particle.rotation}deg)`,
                  animationDuration: particle.duration + 's',
                  animationDelay: particle.delay + 's',
                }}
              />
            ))}
          </div>
        );
      };

      function Calculator() {
        const [display, setDisplay] = useState('0');
        const [previousValue, setPreviousValue] = useState(null);
        const [operator, setOperator] = useState(null);
        const [waitingForOperand, setWaitingForOperand] = useState(false);
        const [confettiParticles, setConfettiParticles] = useState([]);

        // Clean up confetti after animation
        useEffect(() => {
          if (confettiParticles.length > 0) {
            const timer = setTimeout(() => {
              setConfettiParticles([]);
            }, 3000);
            return () => clearTimeout(timer);
          }
        }, [confettiParticles]);

        const triggerConfetti = () => {
          const colors = ['#ff6b6b', '#4ecdc4', '#ffe66d', '#95e1d3', '#f38181', '#aa96da', '#fcbad3', '#a8d8ea'];
          const particles = [];

          for (let i = 0; i < 50; i++) {
            particles.push({
              id: i,
              x: Math.random() * 100,
              color: colors[Math.floor(Math.random() * colors.length)],
              size: Math.random() * 10 + 5,
              shape: Math.random() > 0.5 ? 'circle' : 'square',
              rotation: Math.random() * 360,
              duration: Math.random() * 2 + 2,
              delay: Math.random() * 0.5,
            });
          }

          setConfettiParticles(particles);
        };

        const inputDigit = (digit) => {
          if (waitingForOperand) {
            setDisplay(digit);
            setWaitingForOperand(false);
          } else {
            setDisplay(display === '0' ? digit : display + digit);
          }
        };

        const inputDecimal = () => {
          if (waitingForOperand) {
            setDisplay('0.');
            setWaitingForOperand(false);
            return;
          }
          if (!display.includes('.')) {
            setDisplay(display + '.');
          }
        };

        const clear = () => {
          setDisplay('0');
          setPreviousValue(null);
          setOperator(null);
          setWaitingForOperand(false);
        };

        const performOperation = (nextOperator) => {
          const inputValue = parseFloat(display);

          if (previousValue === null) {
            setPreviousValue(inputValue);
          } else if (operator) {
            const currentValue = previousValue || 0;
            let result;

            switch (operator) {
              case '+':
                result = currentValue + inputValue;
                break;
              case '-':
                result = currentValue - inputValue;
                break;
              case '×':
                result = currentValue * inputValue;
                break;
              case '÷':
                result = inputValue !== 0 ? currentValue / inputValue : 'Error';
                break;
              default:
                result = inputValue;
            }

            setDisplay(String(result));
            setPreviousValue(result);
          }

          setWaitingForOperand(true);
          setOperator(nextOperator);
        };

        const calculate = () => {
          if (!operator || previousValue === null) return;

          const inputValue = parseFloat(display);
          let result;

          switch (operator) {
            case '+':
              result = previousValue + inputValue;
              break;
            case '-':
              result = previousValue - inputValue;
              break;
            case '×':
              result = previousValue * inputValue;
              break;
            case '÷':
              result = inputValue !== 0 ? previousValue / inputValue : 'Error';
              break;
            default:
              result = inputValue;
          }

          setDisplay(String(result));
          setPreviousValue(null);
          setOperator(null);
          setWaitingForOperand(true);

          // Trigger confetti on successful calculation!
          triggerConfetti();
        };

        const toggleSign = () => {
          setDisplay(String(parseFloat(display) * -1));
        };

        const inputPercent = () => {
          setDisplay(String(parseFloat(display) / 100));
        };

        const Button = ({ onClick, className, children }) => (
          <button
            onClick={onClick}
            className={`flex items-center justify-center text-2xl font-medium rounded-full h-16 w-16 transition-all duration-150 active:scale-95 ${className}`}
          >
            {children}
          </button>
        );

        return (
          <>
            {/* Confetti particles */}
            <Confetti particles={confettiParticles} />

            <div className="min-h-screen bg-black flex items-center justify-center p-4">
              <div className="bg-black rounded-3xl p-4 w-80">
                {/* Display */}
                <div className="h-24 flex items-end justify-end px-2 mb-2">
                  <span className="text-white text-6xl font-light truncate">
                    {display.length > 9 ? parseFloat(display).toExponential(4) : display}
                  </span>
                </div>

                {/* Button Grid */}
                <div className="grid grid-cols-4 gap-3">
                  {/* Row 1 */}
                  <Button onClick={clear} className="bg-gray-400 text-black hover:bg-gray-300">
                    {previousValue || operator ? 'C' : 'AC'}
                  </Button>
                  <Button onClick={toggleSign} className="bg-gray-400 text-black hover:bg-gray-300">
                    ±
                  </Button>
                  <Button onClick={inputPercent} className="bg-gray-400 text-black hover:bg-gray-300">
                    %
                  </Button>
                  <Button
                    onClick={() => performOperation('÷')}
                    className={`${operator === '÷' ? 'bg-white text-orange-500' : 'bg-orange-500 text-white hover:bg-orange-400'}`}
                  >
                    ÷
                  </Button>

                  {/* Row 2 */}
                  <Button onClick={() => inputDigit('7')} className="bg-gray-700 text-white hover:bg-gray-600">
                    7
                  </Button>
                  <Button onClick={() => inputDigit('8')} className="bg-gray-700 text-white hover:bg-gray-600">
                    8
                  </Button>
                  <Button onClick={() => inputDigit('9')} className="bg-gray-700 text-white hover:bg-gray-600">
                    9
                  </Button>
                  <Button
                    onClick={() => performOperation('×')}
                    className={`${operator === '×' ? 'bg-white text-orange-500' : 'bg-orange-500 text-white hover:bg-orange-400'}`}
                  >
                    ×
                  </Button>

                  {/* Row 3 */}
                  <Button onClick={() => inputDigit('4')} className="bg-gray-700 text-white hover:bg-gray-600">
                    4
                  </Button>
                  <Button onClick={() => inputDigit('5')} className="bg-gray-700 text-white hover:bg-gray-600">
                    5
                  </Button>
                  <Button onClick={() => inputDigit('6')} className="bg-gray-700 text-white hover:bg-gray-600">
                    6
                  </Button>
                  <Button
                    onClick={() => performOperation('-')}
                    className={`${operator === '-' ? 'bg-white text-orange-500' : 'bg-orange-500 text-white hover:bg-orange-400'}`}
                  >
                    −
                  </Button>

                  {/* Row 4 */}
                  <Button onClick={() => inputDigit('1')} className="bg-gray-700 text-white hover:bg-gray-600">
                    1
                  </Button>
                  <Button onClick={() => inputDigit('2')} className="bg-gray-700 text-white hover:bg-gray-600">
                    2
                  </Button>
                  <Button onClick={() => inputDigit('3')} className="bg-gray-700 text-white hover:bg-gray-600">
                    3
                  </Button>
                  <Button
                    onClick={() => performOperation('+')}
                    className={`${operator === '+' ? 'bg-white text-orange-500' : 'bg-orange-500 text-white hover:bg-orange-400'}`}
                  >
                    +
                  </Button>

                  {/* Row 5 */}
                  <button
                    onClick={() => inputDigit('0')}
                    className="col-span-2 flex items-center justify-start pl-6 text-2xl font-medium rounded-full h-16 bg-gray-700 text-white hover:bg-gray-600 transition-all duration-150 active:scale-95"
                  >
                    0
                  </button>
                  <Button onClick={inputDecimal} className="bg-gray-700 text-white hover:bg-gray-600">
                    .
                  </Button>
                  <Button onClick={calculate} className="bg-orange-500 text-white hover:bg-orange-400">
                    =
                  </Button>
                </div>
              </div>
            </div>
          </>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<Calculator />);
    </script>
  </body>
</html>
